<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All DAAN Members - IIT Delhi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-300">

    <div class="container mx-auto px-6 py-12">
        <a href="index.html" class="inline-flex items-center text-indigo-400 hover:text-indigo-300 transition mb-8">
            <i data-lucide="arrow-left" class="w-5 h-5 mr-2"></i>
            Back to Main Page
        </a>

        <h1 class="text-4xl md:text-5xl font-bold text-white text-center mb-8">All Student Details</h1>

        <div class="max-w-3xl mx-auto mb-8">
            <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i data-lucide="search" class="w-5 h-5 text-gray-400"></i>
                </div>
                <input type="text" id="searchInput" onkeyup="searchTable()" placeholder="Search by name, branch, or school..." class="w-full bg-gray-800 border border-gray-700 text-white rounded-full py-3 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            </div>
        </div>

        <div id="batches-container" class="max-w-5xl mx-auto">
            <!-- Batches and tables will be loaded here by JavaScript -->
        </div>
    </div>

    <script>
        lucide.createIcons();

        async function loadMembers() {
            try {
                const response = await fetch('members.csv');
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.text();
                
                const rows = data.trim().split('\n');
                const headers = rows.shift().split(',').map(h => h.trim());
                
                const students = rows.map(row => {
                    const values = row.split(',');
                    return headers.reduce((obj, header, index) => {
                        obj[header] = values[index] ? values[index].trim() : '';
                        return obj;
                    }, {});
                });

                const batches = students.reduce((acc, student) => {
                    const batchName = student.Batch || 'Uncategorized';
                    if (!acc[batchName]) acc[batchName] = [];
                    acc[batchName].push(student);
                    return acc;
                }, {});

                const container = document.getElementById('batches-container');
                container.innerHTML = ''; // Clear previous content

                for (const batchName in batches) {
                    const heading = document.createElement('h2');
                    heading.className = 'text-2xl font-bold text-white mb-4 mt-8';
                    heading.textContent = batchName;
                    container.appendChild(heading);

                    const tableContainer = document.createElement('div');
                    tableContainer.className = 'bg-gray-800 shadow-lg rounded-lg overflow-hidden';
                    
                    let tableHTML = `
                        <div class="overflow-x-auto">
                            <table class="w-full text-left studentTable">
                                <thead class="bg-gray-700">
                                    <tr>
                                        <th class="p-4 font-semibold text-white">Name</th>
                                        <th class="p-4 font-semibold text-white">Branch</th>
                                        <th class="p-4 font-semibold text-white">School</th>
                                        <th class="p-4 font-semibold text-white">Contact</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-700">
                    `;

                    batches[batchName].forEach(student => {
                        tableHTML += `
                            <tr>
                                <td class="p-4">${student.Name}</td>
                                <td class="p-4">${student.Branch}</td>
                                <td class="p-4">${student.School}</td>
                                <td class="p-4">${student.Contact}</td>
                            </tr>
                        `;
                    });

                    tableHTML += `</tbody></table></div>`;
                    tableContainer.innerHTML = tableHTML;
                    container.appendChild(tableContainer);
                }

            } catch (error) {
                console.error('Error fetching or parsing CSV:', error);
                const container = document.getElementById('batches-container');
                container.innerHTML = `<p class="text-center text-red-400">Could not load member data.</p>`;
            }
        }

        function searchTable() {
            const input = document.getElementById("searchInput");
            const filter = input.value.toUpperCase();
            const tables = document.querySelectorAll(".studentTable");

            tables.forEach(table => {
                const tr = table.getElementsByTagName("tr");
                for (let i = 1; i < tr.length; i++) {
                    let display = "none";
                    const td = tr[i].getElementsByTagName("td");
                    for (let j = 0; j < td.length; j++) {
                        if (td[j]) {
                            const txtValue = td[j].textContent || td[j].innerText;
                            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                                display = "";
                                break;
                            }
                        }
                    }
                    tr[i].style.display = display;
                }
            });
        }

        document.addEventListener('DOMContentLoaded', loadMembers);
    </script>
</body>
</html>
